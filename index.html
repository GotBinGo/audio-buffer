<html>
<body onclick="audioElement.play()">
    <div>hello</div>
    <audio id="audioElement" controls></audio>
    <script>
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const sampleRate = 44100;
        var tl = 50;
        const buffer = audioCtx.createBuffer(1, sampleRate*tl, sampleRate);

        const channelData = buffer.getChannelData(0);

        r = []
        function rn(n) {
            if(r[n])
                return r[n];
            r[n] = Math.random();
            return r[n];
        }

        function hzf(hz, s) {
            return hz + (Math.sin(s*5)*10)
        }

        function divd(s, hz, n) {
            return Math.sin(2 * Math.PI * hzf(hz, s) * s)
        }

        // for (let i = 0; i < sampleRate*tl; i++) {
        //     var s = i / sampleRate;
        //     channelData[i] = 0;
            
        //     channelData[i] +=  divd(s, 440, 1);
        //     // channelData[i] +=  divd(s, 440, 1.5);
        //     // channelData[i] +=  divd(s, 440, 2);
        //     // channelData[i] +=  divd(s, 440, 3);



        //     // channelData[i] +=  divd(i, 440, 1.1);
        //     // channelData[i] +=  divd(i, 440, 1.2);
        //     // channelData[i] +=  divd(i, 440, 1.3);
        //     // channelData[i] +=  divd(i, 440, 1.4);
        //     // channelData[i] +=  divd(i, 440, 1.91);
        //     // channelData[i] +=  divd(i, 440, 2.1);
        //     // channelData[i] +=  divd(i, 440, 2.2);
        //     // channelData[i] +=  divd(i, 440, 2.3);
        //     // channelData[i] +=  divd(i, 440, 2.5);
        //     // channelData[i] +=  divd(i, 440, 2.8);
        //     // channelData[i] +=  divd(i, 440, 6);
        //     // channelData[i] +=  divd(i, 440, 7);
        //     // channelData[i] +=  divd(i, 440, 8);
        //     // channelData[i] +=  divd(i, 440, 9);
        //     // channelData[i] +=  divd(i, 440, 10);
        //     // channelData[i] +=  divd(i, 440, 11);
        //     // channelData[i] +=  divd(i, 440, 12);
        //     // channelData[i] +=  divd(i, 440, 13);
        //     // channelData[i] +=  divd(i, 440, 14);
        //     // channelData[i] +=  divd(i, 440, 15);
        //     // channelData[i] +=  divd(i, 440, 16);
        //     // channelData[i] +=  divd(i, 440, 17);
        //     // channelData[i] +=  divd(i, 440, 18);
        //     // channelData[i] +=  Math.sin(2 * Math.PI * 440 * 2 * (i / sampleRate))/2;
        //     // channelData[i] +=  Math.sin(2 * Math.PI * 440 * 3 * (i / sampleRate))/3;
        //     // channelData[i] +=  Math.sin(2 * Math.PI * 440 * 4 * (i / sampleRate));
        //     // channelData[i] +=  Math.sin(2 * Math.PI * 440 * 5 * (i / sampleRate))/5;
        //     // channelData[i] +=  Math.sin(2 * Math.PI * 440 * 6 * (i / sampleRate));
        //     // channelData[i] +=  Math.sin(2 * Math.PI * 440 * 7 * (i / sampleRate))/7;
        //     // channelData[i] +=  Math.sin(2 * Math.PI * 440 * 8 * (i / sampleRate));
        //     // channelData[i] +=  Math.sin(2 * Math.PI * 440 * 11 * (i / sampleRate))/7;
        //     // channelData[i] +=  Math.sin(2 * Math.PI * 440 * 13 * (i / sampleRate))/(13*13);
        // }


        const baseFreq = 440;   // Hz
const vibratoFreq = 5;  // Hz
const vibratoDepth = 10; // Hz

let phase = 0;
for (let i = 0; i < channelData.length; i++) {
    const t = i / sampleRate;
    const currentFreq = baseFreq + Math.sin(2 * Math.PI * vibratoFreq * t) * vibratoDepth;

    // Phase increment per sample
    phase += (2 * Math.PI * currentFreq) / sampleRate;

    channelData[i] = Math.sin(phase);
}




        var max = 0;
        for (let i = 0; i < sampleRate*tl; i++) {
            if (channelData[i] > max)
                max = channelData[i]
        }

        for (let i = 0; i < sampleRate*tl; i++) {
            channelData[i] = channelData[i] / max
        }

  


        function audioBufferToWav(buffer) {
            const numOfChan = buffer.numberOfChannels;
            const length = buffer.length * numOfChan * 2 + 44;
            const bufferArray = new ArrayBuffer(length);
            const view = new DataView(bufferArray);

            function writeString(view, offset, string) {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            }

            let offset = 0;
            writeString(view, offset, 'RIFF'); offset += 4;
            view.setUint32(offset, 36 + buffer.length * numOfChan * 2, true); offset += 4;
            writeString(view, offset, 'WAVE'); offset += 4;
            writeString(view, offset, 'fmt '); offset += 4;
            view.setUint32(offset, 16, true); offset += 4;
            view.setUint16(offset, 1, true); offset += 2;
            view.setUint16(offset, numOfChan, true); offset += 2;
            view.setUint32(offset, buffer.sampleRate, true); offset += 4;
            view.setUint32(offset, buffer.sampleRate * numOfChan * 2, true); offset += 4;
            view.setUint16(offset, numOfChan * 2, true); offset += 2;
            view.setUint16(offset, 16, true); offset += 2;
            writeString(view, offset, 'data'); offset += 4;
            view.setUint32(offset, buffer.length * numOfChan * 2, true); offset += 4;

            for (let i = 0; i < buffer.length; i++) {
                for (let channel = 0; channel < numOfChan; channel++) {
                    let sample = buffer.getChannelData(channel)[i];
                    sample = Math.max(-1, Math.min(1, sample));
                    view.setInt16(offset, sample < 0 ? sample * 0x8000 : sample * 0x7FFF, true);
                    offset += 2;
                }
            }
            return bufferArray;
        }

        const wavData = audioBufferToWav(buffer);
        const blob = new Blob([wavData], { type: 'audio/wav' });
        const url = URL.createObjectURL(blob);

        const audioElement = document.getElementById("audioElement");
        audioElement.src = url;
        
    </script>
</body>
</html>